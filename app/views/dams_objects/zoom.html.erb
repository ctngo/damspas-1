<%
  @page_title =  "Object | #{grabTitle}"
  @cmp = params['cmp']
  files_key = (@cmp != '0') ? "component_#{@cmp}_files_tesim" : "files_tesim"
  @files = @document[files_key] || []
  @files.each do |f|
    json = JSON.parse(f)
    use = json['use']
    if use == 'image-source' || use == 'document-service'
      @file_id = json['id']
      @quality = json['quality']
    end
  end
  if @quality.blank? %>
  <p>Error: unable to find zoomable image.</p>
<%
  else
    dim = @quality.split("x")
    p1 = @object[0,2]
    p2 = @object[2,2]
    dir = p1 + "/" + p2 + "/" + @object
    dir += "-#{@cmp}" if @cmp != '0'
%>
  <style type="text/css">
    #map { width: 512px; height: 512px; }
  </style>
  <div id="map"></div>
  <script type="text/javascript">
    var imageUrl = '<%=Rails.configuration.zoomify_baseurl%><%=dir%>/'
    imageSize = { width: <%=dim[0]%>, height: <%=dim[1]%> };
    var layer = new ZoomifyLayer(imageUrl, imageSize),
    map = new L.Map('map');
    map.setView(new L.LatLng(0,0), 0);
    map.addLayer(layer);
  </script>
<% end %>
